<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="mystyle.css">
    <script src="https://pixijs.download/release/pixi.min.js"></script>
  </head>
  <body>
    <script>

      class Deck{

        constructor() {
          this.cardOrder = [1,1,2,2,3,3,4,4,];
          this.shuffleArray(this.cardOrder);  
        }

        shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
        }

      }

      //Create deck
      let deck = new Deck();

      // Create the application helper and add its render target to the page
      //const app = new PIXI.Application({ width: 1280, height: 720 });
      const app = new PIXI.Application({ view: document.getElementById("split left") });
      document.body.appendChild(app.view);

      // create a background...
      const background = PIXI.Sprite.from('assets/backgroundImage.png');

      background.width = app.screen.width;
      background.height = app.screen.height;

      app.stage.addChild(background);

      let numberOfCards = 8;

      const cardWidth = 120;
      const cardHeight = 160;
      const xMultiplier = 150;


      const spritePositions = [
      175, 75,
      655, 75,
      410, 325,
      150, 465,
      685, 445,
    ];

      const cardXPositions = [xMultiplier*1, xMultiplier*2, xMultiplier*3, xMultiplier*4, xMultiplier*1, xMultiplier*2, xMultiplier*3, xMultiplier*4, xMultiplier*1, xMultiplier*2, xMultiplier*3, xMultiplier*4];
      const cardYPositions = [100, 400];

      // create textures from an image path
      const c1 = PIXI.Texture.from('assets/c01.png'); 
      const c2 = PIXI.Texture.from('assets/c02.png'); 
      const c3 = PIXI.Texture.from('assets/c03.png'); 
      const c4 = PIXI.Texture.from('assets/c04.png'); 
      const c5 = PIXI.Texture.from('assets/c05.png'); 
      const c6 = PIXI.Texture.from('assets/c06.png'); 
      const c7 = PIXI.Texture.from('assets/c07.png'); 
      const c8 = PIXI.Texture.from('assets/c08.png'); 
      const c9 = PIXI.Texture.from('assets/c09.png'); 
      const c10 = PIXI.Texture.from('assets/c010.png');
      const cardBack = PIXI.Texture.from('assets/card_back.png'); 

      const sprites = [];
      let isACardFlipped = false;
      let isASecondCardFlipped = false;

      for (let i = 1; i < 9; i++) {

        const sprite = new PIXI.Sprite(cardBack);

        sprite.height = cardHeight;
        sprite.width = cardWidth;

        sprite.isFlipped = false;
        sprite.interactive = true;

        sprite.indexNum = deck.cardOrder[i-1];

        sprite.x = cardXPositions[i-1];

        if(i <= 4){
          sprite.y = cardYPositions[0];
          }
        else {
          sprite.y = cardYPositions[1];
        }

        sprite.on('pointertap', (event) => { 
          if(sprite.isFlipped !== true && isASecondCardFlipped === false){
        
          let artString = 'c';

          artString += sprite.indexNum;
          sprite.texture = eval(artString);
          sprite.isFlipped = true;

          if(isACardFlipped === false){isACardFlipped = true;}
          else {
            isASecondCardFlipped = true;
            setTimeout(revertCards, 1500);
          }

          } 
        });

        app.stage.addChild(sprite);

        sprites.push(sprite);
      } 

      function revertCards(){
        
        checkMatchingCardsFlipped();
        
        isACardFlipped = false;
        isASecondCardFlipped = false;
        for (let i = 0; i < sprites.length; i++){
          sprites[i].texture = cardBack;
          sprites[i].isFlipped = false;
        }
      
        
      }

      function checkMatchingCardsFlipped(){
          let firstNum = -1;
          let secondNum = -1;
          let firstSpriteIndex = -1;
          let secondSpriteIndex = -1;

          for (let i = 0; i < sprites.length; i++){
            
            if (sprites[i].isFlipped === true){
              
              if(firstNum === -1){
                firstNum = sprites[i].indexNum;
                firstSpriteIndex = i;
              }
              else{
                secondNum = sprites[i].indexNum;
                secondSpriteIndex = i;
              }
            }
          }

          if(firstNum !== -1 && (firstNum === secondNum)){
            removeMatchingCards(firstNum);
          }

        }

      function removeMatchingCards(numberToRemove){

        numberOfCards -= 2;
        let indexPositionsToRemove = [];

        for (let i = 0; i < sprites.length; i++){
          if(sprites[i].indexNum === numberToRemove){
            indexPositionsToRemove.push(i);
            sprites[i].parent.removeChild(sprites[i]);
          }
        }

      }

      for (let i = 0; i < 8; i++){
        console.log(sprites[i].indexNum);
      }

      /* When the user clicks on the button,
      toggle between hiding and showing the dropdown content */
      function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
      }

      // Close the dropdown menu if the user clicks outside of it
      window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
          var dropdowns = document.getElementsByClassName("dropdown-content");
          var i;
          for (i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
              openDropdown.classList.remove('show');
            }
          }
        }
      }
    </script>


    <div class="split left"></div>
    <div class="split right">
      <div class="centered">
        <div class="dropdown">
          <button onclick="myFunction()" class="dropbtn">Dropdown</button>
          <div id="myDropdown" class="dropdown-content">
            <a href="#">8 tiles</a>
            <a href="#">16 tiles</a>
            <a href="#">24 tiles</a>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>